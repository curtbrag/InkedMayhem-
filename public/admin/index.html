<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”¥</text></svg>">
    <title>Admin â€” InkedMayhem</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cormorant+Garamond:ital,wght@0,400;1,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #060606;
            --dark: #0d0d0d;
            --darker: #141414;
            --surface: #1a1a1a;
            --border: #222;
            --mid: #333;
            --gray: #555;
            --light-gray: #888;
            --muted: #aaa;
            --off-white: #e8e4df;
            --cream: #cdc6bc;
            --white: #f0ece6;
            --red: #c22020;
            --red-bright: #e63030;
            --gold: #c9a84c;
            --green: #2e7d32;
            --font-display: 'Bebas Neue', sans-serif;
            --font-serif: 'Cormorant Garamond', serif;
            --font-mono: 'Space Mono', monospace;
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: var(--black);
            color: var(--off-white);
            font-family: var(--font-mono);
            font-size: 12px;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* â”€â”€â”€ LOGIN SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }
        .login-box {
            background: var(--darker);
            border: 1px solid var(--border);
            padding: 3rem;
            max-width: 380px;
            width: 100%;
            text-align: center;
        }
        .login-box h1 {
            font-family: var(--font-display);
            font-size: 2.5rem;
            letter-spacing: 3px;
            margin-bottom: 0.5rem;
        }
        .login-box h1 span { color: var(--red); }
        .login-box p {
            color: var(--muted);
            margin-bottom: 2rem;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .login-input {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--off-white);
            padding: 0.85rem 1rem;
            font-family: var(--font-mono);
            font-size: 12px;
            margin-bottom: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }
        .login-input:focus { border-color: var(--red); }
        .login-input::placeholder { color: var(--gray); }
        .login-btn {
            width: 100%;
            background: var(--red);
            color: var(--white);
            border: none;
            padding: 0.85rem;
            font-family: var(--font-mono);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .login-btn:hover { background: var(--red-bright); }
        .login-error {
            color: var(--red-bright);
            font-size: 11px;
            margin-top: 1rem;
            display: none;
        }

        /* â”€â”€â”€ DASHBOARD LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .dashboard { display: none; }
        .dash-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            background: var(--darker);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .dash-logo {
            font-family: var(--font-display);
            font-size: 1.5rem;
            letter-spacing: 2px;
            text-decoration: none;
            color: var(--off-white);
        }
        .dash-logo span { color: var(--red); }
        .dash-actions { display: flex; gap: 1rem; align-items: center; }
        .dash-actions a, .dash-actions button {
            background: none;
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 0.5rem 1rem;
            font-family: var(--font-mono);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
        }
        .dash-actions a:hover, .dash-actions button:hover {
            color: var(--off-white);
            border-color: var(--mid);
        }

        /* â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border);
            background: var(--dark);
            overflow-x: auto;
        }
        .tab {
            padding: 1rem 2rem;
            font-family: var(--font-mono);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--muted);
            cursor: pointer;
            border: none;
            background: none;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            transition: all 0.2s;
            position: relative;
        }
        .tab:hover { color: var(--off-white); }
        .tab.active {
            color: var(--red);
            border-bottom-color: var(--red);
        }
        .tab .badge {
            background: var(--red);
            color: #fff;
            font-size: 9px;
            padding: 1px 6px;
            border-radius: 9px;
            margin-left: 6px;
            vertical-align: top;
        }
        .tab-content { display: none; padding: 2rem; max-width: 1400px; margin: 0 auto; }
        .tab-content.active { display: block; }

        /* â”€â”€â”€ STATS CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: var(--darker);
            border: 1px solid var(--border);
            padding: 1.5rem;
        }
        .stat-card .label {
            color: var(--muted);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 0.5rem;
        }
        .stat-card .value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--white);
            line-height: 1;
        }
        .stat-card .sub {
            color: var(--gray);
            font-size: 10px;
            margin-top: 0.35rem;
        }
        .stat-card.red .value { color: var(--red); }
        .stat-card.gold .value { color: var(--gold); }

        /* â”€â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .table-wrap {
            overflow-x: auto;
            background: var(--darker);
            border: 1px solid var(--border);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            background: var(--surface);
            color: var(--muted);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 0.85rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }
        td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            vertical-align: middle;
        }
        tr:hover { background: rgba(255,255,255,0.02); }

        .tier-badge {
            display: inline-block;
            padding: 2px 10px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid;
        }
        .tier-free { color: var(--muted); border-color: var(--mid); }
        .tier-peek { color: var(--red); border-color: var(--red); }
        .tier-vip { color: var(--gold); border-color: var(--gold); }
        .tier-elite { color: #fff; border-color: #fff; background: rgba(255,255,255,0.08); }

        .unread { background: rgba(194, 32, 32, 0.06); }
        .dot-unread {
            display: inline-block;
            width: 7px;
            height: 7px;
            background: var(--red);
            border-radius: 50%;
            margin-right: 6px;
        }

        /* â”€â”€â”€ ACTION BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn-sm {
            background: none;
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 3px 10px;
            font-family: var(--font-mono);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 4px;
        }
        .btn-sm:hover { color: var(--off-white); border-color: var(--mid); }
        .btn-sm.danger:hover { color: var(--red-bright); border-color: var(--red); }
        .btn-sm.primary { border-color: var(--red); color: var(--red); }
        .btn-sm.primary:hover { background: var(--red); color: #fff; }

        /* â”€â”€â”€ MESSAGE DETAIL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .msg-detail {
            background: var(--darker);
            border: 1px solid var(--border);
            padding: 2rem;
            margin-top: 1rem;
            display: none;
        }
        .msg-detail.active { display: block; }
        .msg-meta {
            color: var(--muted);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }
        .msg-body {
            color: var(--off-white);
            font-size: 13px;
            line-height: 1.8;
            padding: 1.5rem;
            background: var(--surface);
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }
        .reply-box {
            display: flex;
            gap: 0.5rem;
        }
        .reply-input {
            flex: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--off-white);
            padding: 0.75rem 1rem;
            font-family: var(--font-mono);
            font-size: 12px;
            outline: none;
            resize: vertical;
            min-height: 40px;
        }
        .reply-input:focus { border-color: var(--red); }
        .reply-send {
            background: var(--red);
            color: #fff;
            border: none;
            padding: 0.75rem 1.5rem;
            font-family: var(--font-mono);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            align-self: flex-end;
        }
        .reply-send:hover { background: var(--red-bright); }

        /* â”€â”€â”€ CONVERSATION THREAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .thread {
            max-height: 500px;
            overflow-y: auto;
            padding: 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            margin-bottom: 1rem;
        }
        .thread-msg {
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            max-width: 80%;
        }
        .thread-msg.from-user {
            background: var(--darker);
            border: 1px solid var(--border);
            margin-right: auto;
        }
        .thread-msg.from-admin {
            background: rgba(194, 32, 32, 0.12);
            border: 1px solid rgba(194, 32, 32, 0.3);
            margin-left: auto;
        }
        .thread-msg .msg-time {
            color: var(--gray);
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.35rem;
        }

        /* â”€â”€â”€ COMPOSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .compose-form {
            background: var(--darker);
            border: 1px solid var(--border);
            padding: 2rem;
            margin-top: 1rem;
        }
        .compose-form label {
            display: block;
            color: var(--muted);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }
        .compose-form input, .compose-form textarea {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--off-white);
            padding: 0.75rem 1rem;
            font-family: var(--font-mono);
            font-size: 12px;
            margin-bottom: 1rem;
            outline: none;
        }
        .compose-form textarea { min-height: 120px; resize: vertical; }
        .compose-form input:focus, .compose-form textarea:focus { border-color: var(--red); }

        /* â”€â”€â”€ SECTION TITLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .section-title {
            font-family: var(--font-display);
            font-size: 1.8rem;
            letter-spacing: 2px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .section-title .icon { color: var(--red); }

        /* â”€â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .empty {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray);
        }
        .empty .icon { font-size: 2rem; margin-bottom: 1rem; }

        /* â”€â”€â”€ SELECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        select {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--off-white);
            padding: 3px 8px;
            font-family: var(--font-mono);
            font-size: 11px;
            outline: none;
            cursor: pointer;
        }

        /* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 0.85rem 1.5rem;
            font-family: var(--font-mono);
            font-size: 11px;
            letter-spacing: 1px;
            z-index: 9999;
            transition: all 0.3s;
        }
        .toast-ok { background: var(--surface); color: var(--off-white); border: 1px solid var(--mid); }
        .toast-err { background: #2a0808; color: var(--red-bright); border: 1px solid var(--red); }

        /* â”€â”€â”€ PIPELINE SPECIFIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .pipe-filter.active { border-color: var(--red); color: var(--red); }
        #pipeDetail .compose-form select { width: 100%; margin-bottom: 0; }
        #pipeDetail .compose-form textarea { min-height: 80px; }

        /* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 768px) {
            .dash-header { padding: 1rem; }
            .tab-content { padding: 1rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            td, th { font-size: 11px; padding: 0.5rem; }
            .msg-detail { padding: 1rem; }
            .thread-msg { max-width: 95%; }
        }

        /* â”€â”€â”€ LOADING SPINNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--mid);
            border-top-color: var(--red);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            vertical-align: middle;
            margin-right: 6px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-text {
            color: var(--muted);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 2rem;
            text-align: center;
        }

        .back-link {
            color: var(--muted);
            text-decoration: none;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            display: inline-block;
            margin-bottom: 1rem;
        }
        .back-link:hover { color: var(--off-white); }
    </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen" class="login-screen">
    <div class="login-box">
        <h1>INKED<span>MAYHEM</span></h1>
        <p>Admin Dashboard</p>
        <form id="loginForm">
            <input type="password" class="login-input" id="adminPass" placeholder="Admin password" autocomplete="current-password" autofocus>
            <button type="submit" class="login-btn" id="loginBtn">Enter</button>
        </form>
        <div class="login-error" id="loginError">Invalid password</div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="dashboard" class="dashboard">
    <!-- HEADER -->
    <header class="dash-header">
        <a href="/admin" class="dash-logo">INKED<span>MAYHEM</span> âš¡ ADMIN</a>
        <div class="dash-actions">
            <a href="/" target="_blank">View Site</a>
            <button onclick="logout()">Logout</button>
        </div>
    </header>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab active" data-tab="overview">Overview</button>
        <button class="tab" data-tab="pipeline">Pipeline <span class="badge" id="pipelineBadge" style="display:none">0</span></button>
        <button class="tab" data-tab="calendar">Calendar</button>
        <button class="tab" data-tab="users">Users</button>
        <button class="tab" data-tab="messages">Messages <span class="badge" id="unreadBadge" style="display:none">0</span></button>
        <button class="tab" data-tab="conversations">Conversations</button>
        <button class="tab" data-tab="content">Content</button>
        <button class="tab" data-tab="analytics">Analytics</button>
        <button class="tab" data-tab="settings">Settings</button>
    </div>

    <!-- â”€â”€â”€ OVERVIEW TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content active" id="tab-overview">
        <div class="section-title"><span class="icon">â—†</span> Dashboard</div>
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="label">Total Users</div>
                <div class="value" id="statUsers">â€”</div>
            </div>
            <div class="stat-card red">
                <div class="label">Unread Messages</div>
                <div class="value" id="statUnread">â€”</div>
            </div>
            <div class="stat-card gold">
                <div class="label">Conversations</div>
                <div class="value" id="statConvos">â€”</div>
            </div>
            <div class="stat-card">
                <div class="label">Total Messages</div>
                <div class="value" id="statMsgs">â€”</div>
            </div>
        </div>

        <!-- Pipeline Overview -->
        <div class="section-title" style="font-size:1.3rem; margin-top: 2rem;"><span class="icon">â—†</span> Content Pipeline</div>
        <div class="stats-grid" id="overviewPipeGrid">
            <div class="stat-card"><div class="label">Pipeline Inbox</div><div class="value" id="overviewPipeInbox">â€”</div></div>
            <div class="stat-card gold"><div class="label">Queued</div><div class="value" id="overviewPipeQueued">â€”</div></div>
            <div class="stat-card"><div class="label">Published</div><div class="value" id="overviewPipePublished" style="color:var(--green)">â€”</div></div>
        </div>

        <div class="section-title" style="font-size:1.3rem; margin-top: 2rem;"><span class="icon">â—†</span> Tier Breakdown</div>
        <div class="stats-grid" id="tierGrid">
            <div class="stat-card"><div class="label">Free</div><div class="value" id="tierFree">â€”</div></div>
            <div class="stat-card"><div class="label">Peek</div><div class="value" id="tierPeek" style="color:var(--red)">â€”</div></div>
            <div class="stat-card"><div class="label">VIP</div><div class="value" id="tierVip" style="color:var(--gold)">â€”</div></div>
            <div class="stat-card"><div class="label">Elite</div><div class="value" id="tierElite" style="color:#fff">â€”</div></div>
        </div>

        <div class="section-title" style="font-size:1.3rem; margin-top: 2rem;"><span class="icon">â—†</span> Quick Links</div>
        <div class="stats-grid">
            <a href="https://app.bitly.com/Bp7qhhu6cW6/bitlinks/bit.ly/4knjXOU" target="_blank" style="text-decoration:none">
                <div class="stat-card" style="cursor:pointer;transition:transform .15s;border:1px solid rgba(255,45,45,0.3)">
                    <div class="label">ğŸ“Š Bitly Analytics</div>
                    <div class="value" style="font-size:1rem;color:var(--red)">Click Tracking â†’</div>
                </div>
            </a>
            <a href="https://app.netlify.com/projects/inkedmayhem/overview" target="_blank" style="text-decoration:none">
                <div class="stat-card" style="cursor:pointer;transition:transform .15s;border:1px solid rgba(0,173,181,0.3)">
                    <div class="label">ğŸš€ Netlify Dashboard</div>
                    <div class="value" style="font-size:1rem;color:#00adb5">Site Settings â†’</div>
                </div>
            </a>
            <a href="https://github.com/curtbrag/InkedMayhem-" target="_blank" style="text-decoration:none">
                <div class="stat-card" style="cursor:pointer;transition:transform .15s;border:1px solid rgba(255,255,255,0.15)">
                    <div class="label">ğŸ’» GitHub Repo</div>
                    <div class="value" style="font-size:1rem;color:var(--off-white)">Source Code â†’</div>
                </div>
            </a>
            <a href="https://inkedmayhem.netlify.app" target="_blank" style="text-decoration:none">
                <div class="stat-card" style="cursor:pointer;transition:transform .15s;border:1px solid rgba(212,175,55,0.3)">
                    <div class="label">ğŸŒ Live Site</div>
                    <div class="value" style="font-size:1rem;color:var(--gold)">inkedmayhem.netlify.app â†’</div>
                </div>
            </a>
        </div>
    </div>

    <!-- â”€â”€â”€ PIPELINE TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content" id="tab-pipeline">
        <div class="section-title"><span class="icon">â—†</span> Content Pipeline</div>
        <div class="stats-grid">
            <div class="stat-card"><div class="label">Inbox</div><div class="value" id="pipeInbox">â€”</div><div class="sub">Awaiting review</div></div>
            <div class="stat-card"><div class="label">Processed</div><div class="value" id="pipeProcessed">â€”</div><div class="sub">Checks complete</div></div>
            <div class="stat-card gold"><div class="label">Queued</div><div class="value" id="pipeQueued">â€”</div><div class="sub">Ready to publish</div></div>
            <div class="stat-card" style="border-left:2px solid var(--green)"><div class="label">Published</div><div class="value" id="pipePublished" style="color:var(--green)">â€”</div></div>
            <div class="stat-card red"><div class="label">Rejected</div><div class="value" id="pipeRejected">â€”</div></div>
        </div>
        <div style="display:flex;gap:0.5rem;margin-bottom:1.5rem;flex-wrap:wrap">
            <button class="btn-sm primary" onclick="pipeUploadModal()">+ Upload Content</button>
            <button class="btn-sm" onclick="pipeProcessAll()">Process All Inbox</button>
            <button class="btn-sm" onclick="pipePublishAll()">Publish All Queued</button>
            <button class="btn-sm" onclick="pipeCheckSchedule()">Run Schedule Check</button>
        </div>
        <div style="display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap">
            <button class="btn-sm pipe-filter active" data-filter="all" onclick="filterPipeline('all',this)">All</button>
            <button class="btn-sm pipe-filter" data-filter="inbox" onclick="filterPipeline('inbox',this)">Inbox</button>
            <button class="btn-sm pipe-filter" data-filter="processed" onclick="filterPipeline('processed',this)">Processed</button>
            <button class="btn-sm pipe-filter" data-filter="queued" onclick="filterPipeline('queued',this)">Queued</button>
            <button class="btn-sm pipe-filter" data-filter="published" onclick="filterPipeline('published',this)">Published</button>
            <button class="btn-sm pipe-filter" data-filter="rejected" onclick="filterPipeline('rejected',this)">Rejected</button>
        </div>
        <div id="pipeLoading" class="loading-text"><span class="spinner"></span> Loading pipeline...</div>
        <div class="table-wrap" id="pipeTable" style="display:none">
            <table><thead><tr><th>Status</th><th>File</th><th>Caption</th><th>Category</th><th>Tier</th><th>Source</th><th>Date</th><th>Actions</th></tr></thead><tbody id="pipeBody"></tbody></table>
        </div>
        <div class="empty" id="pipeEmpty" style="display:none"><div class="icon">ğŸ“‚</div><p>No items in the pipeline. Upload content to get started.</p></div>
        <div class="msg-detail" id="pipeDetail">
            <span class="back-link" onclick="closePipeDetail()">â† Back to pipeline</span>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-top:1rem">
                <div>
                    <div class="msg-meta" id="pipeDetailMeta"></div>
                    <div id="pipeDetailPreview" style="margin:1rem 0;max-width:100%;background:var(--surface);border:1px solid var(--border);padding:1rem;text-align:center"><span style="color:var(--gray)">Preview</span></div>
                    <div id="pipeDetailChecks" style="margin-top:1rem"></div>
                </div>
                <div>
                    <div class="compose-form" style="margin-top:0;border:none;padding:0;background:none">
                        <label>Caption</label>
                        <textarea id="pipeEditCaption" placeholder="Add a caption..."></textarea>
                        <label>Category</label>
                        <select id="pipeEditCategory"><option value="photos">Photos</option><option value="selfies">Selfies</option><option value="lifestyle">Lifestyle</option><option value="behind-the-scenes">Behind the Scenes</option></select>
                        <label style="margin-top:1rem">Access Tier</label>
                        <select id="pipeEditTier"><option value="free">Free</option><option value="vip">VIP</option><option value="elite">Elite</option></select>
                        <label style="margin-top:1rem">Schedule (optional)</label>
                        <input type="datetime-local" id="pipeEditSchedule" style="width:100%;background:var(--surface);border:1px solid var(--border);color:var(--off-white);padding:0.75rem 1rem;font-family:var(--font-mono);font-size:12px">
                        <div style="display:flex;gap:0.5rem;margin-top:1.5rem;flex-wrap:wrap">
                            <button class="btn-sm primary" onclick="pipeApproveItem()">Approve + Queue</button>
                            <button class="btn-sm" onclick="pipeSaveItem()">Save Changes</button>
                            <button class="btn-sm" onclick="pipePublishItem()">Publish Now</button>
                            <button class="btn-sm danger" onclick="pipeRejectItem()">Reject</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="pipeUploadPanel" style="display:none">
            <div class="compose-form" style="margin-top:1rem">
                <div class="section-title" style="font-size:1.2rem"><span class="icon">â—†</span> Upload Content</div>
                <label>File</label>
                <input type="file" id="pipeFileInput" accept="image/*,video/*" style="background:var(--surface);border:1px solid var(--border);color:var(--off-white);padding:0.75rem;width:100%;font-family:var(--font-mono);font-size:12px;margin-bottom:1rem">
                <label>Caption</label>
                <input type="text" id="pipeUpCaption" placeholder="Optional caption" style="width:100%;background:var(--surface);border:1px solid var(--border);color:var(--off-white);padding:0.75rem 1rem;font-family:var(--font-mono);font-size:12px;margin-bottom:1rem">
                <div style="display:flex;gap:1rem;margin-bottom:1rem"><div style="flex:1"><label>Category</label><select id="pipeUpCategory" style="width:100%"><option value="photos">Photos</option><option value="selfies">Selfies</option><option value="lifestyle">Lifestyle</option><option value="behind-the-scenes">Behind the Scenes</option></select></div><div style="flex:1"><label>Tier</label><select id="pipeUpTier" style="width:100%"><option value="free">Free</option><option value="vip">VIP</option><option value="elite">Elite</option></select></div></div>
                <div style="display:flex;gap:0.5rem"><button class="login-btn" style="max-width:200px" id="pipeUploadBtn" onclick="pipeDoUpload()">Upload</button><button class="btn-sm" onclick="pipeCloseUpload()">Cancel</button></div>
                <div id="pipeUploadProgress" style="display:none;margin-top:1rem;color:var(--muted);font-size:11px"><span class="spinner"></span> Uploading...</div>
            </div>
        </div>
        <div style="margin-top:2rem">
            <div class="section-title" style="font-size:1.2rem"><span class="icon">â—†</span> Recent Activity</div>
            <div id="pipeActivityLog" style="background:var(--darker);border:1px solid var(--border);padding:1rem;max-height:300px;overflow-y:auto"><div class="loading-text"><span class="spinner"></span> Loading activity...</div></div>
        </div>
    </div>

    <!-- â”€â”€â”€ USERS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content" id="tab-users">
        <div class="section-title"><span class="icon">â—†</span> Registered Users</div>
        <div id="usersLoading" class="loading-text"><span class="spinner"></span> Loading users...</div>
        <div class="table-wrap" id="usersTable" style="display:none">
            <table>
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Name</th>
                        <th>Tier</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersBody"></tbody>
            </table>
        </div>
        <div class="empty" id="usersEmpty" style="display:none">
            <div class="icon">ğŸ‘¤</div>
            <p>No registered users yet</p>
        </div>
    </div>

    <!-- â”€â”€â”€ MESSAGES TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content" id="tab-messages">
        <div class="section-title"><span class="icon">â—†</span> Contact Messages</div>
        <div id="msgsLoading" class="loading-text"><span class="spinner"></span> Loading messages...</div>
        <div class="table-wrap" id="msgsTable" style="display:none">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>From</th>
                        <th>Subject</th>
                        <th>Preview</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="msgsBody"></tbody>
            </table>
        </div>
        <div class="msg-detail" id="msgDetail">
            <span class="back-link" onclick="closeMsgDetail()">â† Back to messages</span>
            <div class="msg-meta" id="msgDetailMeta"></div>
            <div class="msg-body" id="msgDetailBody"></div>
            <div id="msgReplies"></div>
            <div class="reply-box">
                <textarea class="reply-input" id="replyInput" placeholder="Type your reply..."></textarea>
                <button class="reply-send" id="replyBtn" onclick="sendReply()">Send</button>
            </div>
        </div>
        <div class="empty" id="msgsEmpty" style="display:none">
            <div class="icon">âœ‰ï¸</div>
            <p>No messages yet</p>
        </div>
    </div>

    <!-- â”€â”€â”€ CONVERSATIONS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content" id="tab-conversations">
        <div class="section-title"><span class="icon">â—†</span> Conversations</div>
        <div id="convoList">
            <div id="convosLoading" class="loading-text"><span class="spinner"></span> Loading conversations...</div>
            <div class="table-wrap" id="convosTable" style="display:none">
                <table>
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Messages</th>
                            <th>Last Message</th>
                            <th>Last Activity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="convosBody"></tbody>
                </table>
            </div>
            <div class="empty" id="convosEmpty" style="display:none">
                <div class="icon">ğŸ’¬</div>
                <p>No conversations yet</p>
            </div>

            <!-- Compose new message -->
            <div class="compose-form" style="margin-top: 2rem">
                <div class="section-title" style="font-size: 1.2rem;"><span class="icon">â—†</span> Send New Message</div>
                <label>Recipient Email</label>
                <input type="email" id="composeEmail" placeholder="user@example.com">
                <label>Message</label>
                <textarea id="composeText" placeholder="Type your message..."></textarea>
                <button class="login-btn" style="max-width: 200px" onclick="composeSend()">Send Message</button>
            </div>
        </div>

        <!-- Thread view -->
        <div id="convoThread" style="display:none">
            <span class="back-link" onclick="closeThread()">â† Back to conversations</span>
            <div class="msg-meta" id="threadMeta"></div>
            <div class="thread" id="threadMessages"></div>
            <div class="reply-box">
                <textarea class="reply-input" id="threadReplyInput" placeholder="Type your message..."></textarea>
                <button class="reply-send" onclick="threadSend()">Send</button>
            </div>
        </div>
    </div>

    <!-- â”€â”€â”€ CONTENT TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content" id="tab-content">
        <div class="section-title"><span class="icon">â—†</span> Content Manager</div>
        <div style="display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap">
            <button class="btn-sm primary" onclick="showContentEditor()" style="font-size:14px;padding:0.5rem 1.2rem">+ New Post</button>
            <button class="btn-sm" onclick="loadContent()" style="font-size:14px;padding:0.5rem 1.2rem">Refresh</button>
        </div>

        <!-- Content editor -->
        <div id="contentEditor" style="display:none;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);padding:1.5rem;margin-bottom:2rem">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
                <div style="font-size:1.1rem;font-weight:700;color:var(--off-white)" id="editorTitle">New Post</div>
                <span style="cursor:pointer;color:var(--muted);font-size:18px" onclick="hideContentEditor()">âœ•</span>
            </div>
            <input type="hidden" id="contentKey" value="">
            <label style="color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;display:block">Title</label>
            <input type="text" id="contentTitleInput" placeholder="Post title..." style="width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:var(--off-white);padding:0.6rem;margin-bottom:1rem;font-size:14px">
            <div style="display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap">
                <div style="flex:1;min-width:120px">
                    <label style="color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px">Access Tier</label>
                    <select id="contentTier" style="width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:var(--off-white);padding:0.5rem">
                        <option value="free">Free (Everyone)</option>
                        <option value="vip">VIP ($9.99/mo)</option>
                        <option value="elite">Elite ($24.99/mo)</option>
                    </select>
                </div>
                <div style="flex:1;min-width:120px">
                    <label style="color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px">Type</label>
                    <select id="contentType" style="width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:var(--off-white);padding:0.5rem">
                        <option value="post">Blog Post</option>
                        <option value="gallery">Gallery Update</option>
                        <option value="announcement">Announcement</option>
                    </select>
                </div>
            </div>
            <label style="color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;display:block">Image URL (optional)</label>
            <input type="text" id="contentImage" placeholder="https://..." style="width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:var(--off-white);padding:0.6rem;margin-bottom:1rem;font-size:14px">
            <label style="color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;display:block">Content</label>
            <textarea id="contentBody" placeholder="Write your post content here... HTML is supported." style="width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:var(--off-white);padding:0.6rem;min-height:200px;font-size:14px;font-family:inherit;line-height:1.6;resize:vertical"></textarea>
            <div style="display:flex;gap:1rem;margin-top:1rem;flex-wrap:wrap">
                <button class="login-btn" style="max-width:180px;font-size:14px" onclick="saveContent(false)">Publish</button>
                <button class="btn-sm" style="font-size:14px;padding:0.5rem 1.2rem" onclick="saveContent(true)">Save as Draft</button>
            </div>
        </div>

        <!-- Content list -->
        <div id="contentLoading" class="loading-text"><span class="spinner"></span> Loading content...</div>
        <div class="table-wrap" id="contentTable" style="display:none">
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Type</th>
                        <th>Tier</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="contentBody"></tbody>
            </table>
        </div>
        <div class="empty" id="contentEmpty" style="display:none">
            <div class="icon">ğŸ“</div>
            <p>No content yet. Click "+ New Post" to create your first one!</p>
        </div>
    </div>

    <!-- â”€â”€â”€ ANALYTICS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <!-- â”€â”€â”€ CALENDAR TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content" id="tab-calendar">
        <div class="section-title"><span class="icon">â—†</span> Content Calendar</div>
        <div style="display:flex; gap:1rem; margin-bottom:1.5rem; align-items:center">
            <button class="btn-sm" onclick="calPrevMonth()">&lt; Prev</button>
            <span id="calMonthLabel" style="font-family:var(--font-display); font-size:1.3rem; letter-spacing:2px; min-width:180px; text-align:center"></span>
            <button class="btn-sm" onclick="calNextMonth()">Next &gt;</button>
            <button class="btn-sm primary" onclick="calToday()" style="margin-left:1rem">Today</button>
        </div>
        <div style="display:grid; grid-template-columns:repeat(7,1fr); gap:1px; background:var(--border)">
            <div style="background:var(--surface); padding:0.5rem; text-align:center; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px">Sun</div>
            <div style="background:var(--surface); padding:0.5rem; text-align:center; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px">Mon</div>
            <div style="background:var(--surface); padding:0.5rem; text-align:center; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px">Tue</div>
            <div style="background:var(--surface); padding:0.5rem; text-align:center; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px">Wed</div>
            <div style="background:var(--surface); padding:0.5rem; text-align:center; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px">Thu</div>
            <div style="background:var(--surface); padding:0.5rem; text-align:center; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px">Fri</div>
            <div style="background:var(--surface); padding:0.5rem; text-align:center; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px">Sat</div>
        </div>
        <div id="calGrid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:1px; background:var(--border)"></div>
        <div style="margin-top:2rem">
            <div class="section-title" style="font-size:1.2rem"><span class="icon">â—†</span> Upcoming Scheduled Posts</div>
            <div id="calUpcoming" style="background:var(--darker); border:1px solid var(--border); padding:1rem">
                <div class="loading-text"><span class="spinner"></span> Loading schedule...</div>
            </div>
        </div>
    </div>

    <div class="tab-content" id="tab-analytics">
        <div class="section-title"><span class="icon">â—†</span> Analytics</div>

        <div class="stats-grid" style="margin-bottom:2rem">
            <div class="stat-card">
                <div class="label">Signups (7 days)</div>
                <div class="value" id="analSignups7d">â€”</div>
            </div>
            <div class="stat-card red">
                <div class="label">Logins (7 days)</div>
                <div class="value" id="analLogins7d">â€”</div>
            </div>
            <div class="stat-card gold">
                <div class="label">Content Posts</div>
                <div class="value" id="analContent">â€”</div>
            </div>
            <div class="stat-card">
                <div class="label">Paying Members</div>
                <div class="value" id="analPaying">â€”</div>
            </div>
        </div>

        <div class="section-title" style="font-size:1.2rem;margin-top:2rem"><span class="icon">â—†</span> Tier Distribution</div>
        <div id="tierChart" style="display:flex;gap:4px;height:40px;margin:1rem 0 0.5rem 0;max-width:600px"></div>
        <div id="tierLegend" style="display:flex;gap:1.5rem;font-size:11px;color:var(--muted);flex-wrap:wrap;margin-bottom:2rem"></div>

        <div class="section-title" style="font-size:1.2rem;margin-top:2rem"><span class="icon">â—†</span> Signup Timeline</div>
        <div id="signupChart" style="display:flex;align-items:flex-end;gap:3px;height:120px;margin:1rem 0;max-width:800px;padding-bottom:20px;position:relative"></div>

        <div class="section-title" style="font-size:1.2rem;margin-top:2rem"><span class="icon">â—†</span> Revenue Estimate</div>
        <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);padding:1.5rem;max-width:400px">
            <div style="font-size:2rem;font-weight:700;color:var(--gold)" id="analRevenue">$0</div>
            <div style="color:var(--muted);font-size:12px;margin-top:4px">Estimated monthly recurring (VIP Ã— $9.99 + Elite Ã— $24.99)</div>
        </div>

        <div class="section-title" style="font-size:1.2rem;margin-top:2rem"><span class="icon">â—†</span> Admin Tools</div>
        <div style="display:flex;gap:1rem;flex-wrap:wrap;margin-top:1rem">
            <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);padding:1.5rem;flex:1;min-width:280px">
                <div style="font-size:14px;font-weight:700;color:var(--off-white);margin-bottom:1rem">Reset User Password</div>
                <input type="email" id="resetEmail" placeholder="user@example.com" style="width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:var(--off-white);padding:0.5rem;margin-bottom:0.5rem">
                <input type="text" id="resetPass" placeholder="New password (min 6 chars)" style="width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);color:var(--off-white);padding:0.5rem;margin-bottom:0.5rem">
                <button class="btn-sm primary" onclick="resetUserPassword()" style="font-size:13px;padding:0.4rem 1rem">Reset Password</button>
            </div>
        </div>
    </div>

    <!-- â”€â”€â”€ SETTINGS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-content" id="tab-settings">
        <div class="section-title"><span class="icon">â—†</span> Settings & Configuration</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:2rem">
            <div>
                <div class="section-title" style="font-size:1.2rem"><span class="icon">â—†</span> Creator Profile</div>
                <div style="background:var(--darker); border:1px solid var(--border); padding:1.5rem">
                    <label style="display:block; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px; margin-bottom:0.3rem">Creator Name</label>
                    <input type="text" id="setCreatorName" placeholder="InkedMayhem" style="width:100%; background:var(--surface); border:1px solid var(--border); color:var(--off-white); padding:0.5rem; font-family:var(--font-mono); font-size:12px; margin-bottom:0.75rem">
                    <label style="display:block; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px; margin-bottom:0.3rem">Handle</label>
                    <input type="text" id="setCreatorHandle" placeholder="@inkedmayhem" style="width:100%; background:var(--surface); border:1px solid var(--border); color:var(--off-white); padding:0.5rem; font-family:var(--font-mono); font-size:12px; margin-bottom:0.75rem">
                    <label style="display:block; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px; margin-bottom:0.3rem">Creator Tier</label>
                    <select id="setCreatorTier" style="width:100%; background:var(--surface); border:1px solid var(--border); color:var(--off-white); padding:0.5rem; font-family:var(--font-mono); font-size:12px; margin-bottom:0.75rem">
                        <option value="A">A â€” Manual approval</option>
                        <option value="B">B â€” Trusted auto-publish</option>
                        <option value="C">C â€” Scheduled</option>
                        <option value="D">D â€” Full automation</option>
                    </select>
                    <label style="display:block; color:var(--muted); font-size:10px; text-transform:uppercase; letter-spacing:1px; margin-bottom:0.3rem">Moderation Level</label>
                    <select id="setModLevel" style="width:100%; background:var(--surface); border:1px solid var(--border); color:var(--off-white); padding:0.5rem; font-family:var(--font-mono); font-size:12px; margin-bottom:1rem">
                        <option value="manual">Manual â€” Review everything</option>
                        <option value="trusted">Trusted â€” Auto-approve</option>
                        <option value="scheduled">Scheduled â€” Auto-queue</option>
                    </select>
                    <button class="btn-sm primary" onclick="saveCreatorConfig()" style="font-size:13px; padding:0.4rem 1rem">Save Profile</button>
                </div>
            </div>
            <div>
                <div class="section-title" style="font-size:1.2rem"><span class="icon">â—†</span> Telegram Bots</div>
                <div style="background:var(--darker); border:1px solid var(--border); padding:1.5rem; margin-bottom:1rem">
                    <div style="display:flex; gap:1rem; margin-bottom:1rem">
                        <span id="tgCreatorStatus" style="font-size:11px"></span>
                        <span id="tgFanStatus" style="font-size:11px"></span>
                    </div>
                    <button class="btn-sm primary" onclick="setupTelegramBot('creator')">Setup Creator Bot</button>
                    <button class="btn-sm" onclick="setupTelegramBot('fan')">Setup Fan Bot</button>
                    <div id="tgSetupResult" style="margin-top:0.75rem; font-size:11px; color:var(--muted)"></div>
                </div>
                <div class="section-title" style="font-size:1.2rem"><span class="icon">â—†</span> Content Rules</div>
                <div style="background:var(--darker); border:1px solid var(--border); padding:1.5rem">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; font-size:11px; margin-bottom:1rem">
                        <label style="display:flex; align-items:center; gap:0.5rem; cursor:pointer"><input type="checkbox" id="setStripExif" checked style="accent-color:var(--red)"> Strip EXIF data</label>
                        <label style="display:flex; align-items:center; gap:0.5rem; cursor:pointer"><input type="checkbox" id="setCompress" checked style="accent-color:var(--red)"> Compress images</label>
                        <label style="display:flex; align-items:center; gap:0.5rem; cursor:pointer"><input type="checkbox" id="setThumbnails" checked style="accent-color:var(--red)"> Generate thumbnails</label>
                        <label style="display:flex; align-items:center; gap:0.5rem; cursor:pointer"><input type="checkbox" id="setAutoApprove" style="accent-color:var(--red)"> Auto-approve</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Creators List -->
        <div style="margin-top:2rem">
            <div class="section-title" style="font-size:1.2rem"><span class="icon">â—†</span> Managed Creators</div>
            <div id="creatorsListLoading" class="loading-text"><span class="spinner"></span> Loading creators...</div>
            <div id="creatorsList" style="display:none"></div>
            <div style="background:var(--darker); border:1px solid var(--border); padding:1.5rem; margin-top:1rem">
                <div class="section-title" style="font-size:1rem"><span class="icon">â—†</span> Onboard New Creator</div>
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:1rem">
                    <div>
                        <label style="display:block; color:var(--muted); font-size:10px; text-transform:uppercase; margin-bottom:0.3rem">Name</label>
                        <input type="text" id="onboardName" placeholder="Creator Name" style="width:100%; background:var(--surface); border:1px solid var(--border); color:var(--off-white); padding:0.5rem; font-family:var(--font-mono); font-size:12px">
                    </div>
                    <div>
                        <label style="display:block; color:var(--muted); font-size:10px; text-transform:uppercase; margin-bottom:0.3rem">Handle</label>
                        <input type="text" id="onboardHandle" placeholder="@handle" style="width:100%; background:var(--surface); border:1px solid var(--border); color:var(--off-white); padding:0.5rem; font-family:var(--font-mono); font-size:12px">
                    </div>
                    <div>
                        <label style="display:block; color:var(--muted); font-size:10px; text-transform:uppercase; margin-bottom:0.3rem">Tagline</label>
                        <input type="text" id="onboardTagline" placeholder="Brand tagline" style="width:100%; background:var(--surface); border:1px solid var(--border); color:var(--off-white); padding:0.5rem; font-family:var(--font-mono); font-size:12px">
                    </div>
                </div>
                <div style="display:flex; gap:1rem; margin-top:0.75rem; align-items:center">
                    <label style="display:flex; align-items:center; gap:0.3rem; font-size:11px; cursor:pointer"><input type="checkbox" id="onboardMembership" style="accent-color:var(--red)"> Membership</label>
                    <label style="display:flex; align-items:center; gap:0.3rem; font-size:11px; cursor:pointer"><input type="checkbox" id="onboardBlog" style="accent-color:var(--red)"> Blog</label>
                    <label style="display:flex; align-items:center; gap:0.3rem; font-size:11px; cursor:pointer"><input type="checkbox" id="onboardFaq" style="accent-color:var(--red)"> FAQ Bot</label>
                    <button class="btn-sm primary" onclick="onboardCreator()" style="margin-left:auto">Onboard Creator</button>
                </div>
                <div id="onboardResult" style="margin-top:0.75rem; display:none"></div>
            </div>
        </div>
    </div>
</div>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN DASHBOARD â€” JavaScript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const API = '/api/admin';
let TOKEN = localStorage.getItem('im_admin_token');
let currentMsgKey = null;
let currentConvKey = null;
let currentConvEmail = null;

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function headers() {
    return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${TOKEN}` };
}

async function api(path, method = 'GET', body = null) {
    const opts = { method, headers: headers() };
    if (body) opts.body = JSON.stringify(body);
    const r = await fetch(`${API}${path}`, opts);
    return r.json();
}

document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const pass = document.getElementById('adminPass').value;
    const btn = document.getElementById('loginBtn');
    btn.textContent = 'Checking...';
    btn.disabled = true;

    try {
        const r = await fetch(`${API}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: pass })
        });
        const data = await r.json();
        if (data.success) {
            TOKEN = data.token;
            localStorage.setItem('im_admin_token', TOKEN);
            showDashboard();
        } else {
            document.getElementById('loginError').style.display = 'block';
        }
    } catch { document.getElementById('loginError').style.display = 'block'; }
    btn.textContent = 'Enter';
    btn.disabled = false;
});

function logout() {
    TOKEN = null;
    localStorage.removeItem('im_admin_token');
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('adminPass').value = '';
}

async function showDashboard() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    loadStats();
    loadPipelineStats();
}

// Check existing session
if (TOKEN) {
    // Verify token still works
    fetch(`${API}/stats`, { headers: { 'Authorization': `Bearer ${TOKEN}` } })
        .then(r => r.json())
        .then(d => { if (d.success) showDashboard(); else logout(); })
        .catch(() => logout());
}

// â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');

        // Load data for tab
        if (tab.dataset.tab === 'users') loadUsers();
        if (tab.dataset.tab === 'messages') loadMessages();
        if (tab.dataset.tab === 'conversations') loadConversations();
        if (tab.dataset.tab === 'content') loadContent();
        if (tab.dataset.tab === 'analytics') loadAnalytics();
        if (tab.dataset.tab === 'overview') { loadStats(); loadPipelineStats(); }
        if (tab.dataset.tab === 'pipeline') { loadPipeline(); loadPipelineStats(); }
        if (tab.dataset.tab === 'calendar') loadCalendar();
        if (tab.dataset.tab === 'settings') loadSettingsTab();
    });
});

// â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadStats() {
    try {
        const data = await api('/stats');
        if (!data.success) return;
        const s = data.stats;
        document.getElementById('statUsers').textContent = s.totalUsers;
        document.getElementById('statUnread').textContent = s.unreadMessages;
        document.getElementById('statConvos').textContent = s.totalConversations;
        document.getElementById('statMsgs').textContent = s.totalMessages;
        document.getElementById('tierFree').textContent = s.tiers.free || 0;
        document.getElementById('tierPeek').textContent = s.tiers.peek || 0;
        document.getElementById('tierVip').textContent = s.tiers.vip || 0;
        document.getElementById('tierElite').textContent = s.tiers.elite || 0;

        const badge = document.getElementById('unreadBadge');
        if (s.unreadMessages > 0) {
            badge.textContent = s.unreadMessages;
            badge.style.display = 'inline';
        } else {
            badge.style.display = 'none';
        }
    } catch (e) { console.error('Stats error:', e); }
}

// â”€â”€â”€ USERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadUsers() {
    document.getElementById('usersLoading').style.display = 'block';
    document.getElementById('usersTable').style.display = 'none';
    document.getElementById('usersEmpty').style.display = 'none';

    try {
        const data = await api('/users');
        document.getElementById('usersLoading').style.display = 'none';

        if (!data.success || !data.users.length) {
            document.getElementById('usersEmpty').style.display = 'block';
            return;
        }

        const tbody = document.getElementById('usersBody');
        tbody.innerHTML = data.users.map(u => `
            <tr>
                <td>${esc(u.email)}</td>
                <td>${esc(u.name)}</td>
                <td>
                    <select onchange="updateUserTier('${esc(u.key)}', this.value)">
                        ${['free','peek','vip','elite'].map(t =>
                            `<option value="${t}" ${u.tier===t?'selected':''}>${t.toUpperCase()}</option>`
                        ).join('')}
                    </select>
                </td>
                <td>${formatDate(u.createdAt)}</td>
                <td>
                    <button class="btn-sm" onclick="messageUser('${esc(u.email)}')">Message</button>
                    <button class="btn-sm danger" onclick="deleteUser('${esc(u.key)}', '${esc(u.email)}')">Delete</button>
                </td>
            </tr>
        `).join('');
        document.getElementById('usersTable').style.display = 'block';
    } catch (e) {
        document.getElementById('usersLoading').style.display = 'none';
        toast('Failed to load users', true);
    }
}

async function updateUserTier(key, tier) {
    const data = await api('/users/update', 'POST', { userKey: key, tier });
    if (data.success) toast(`Tier updated to ${tier.toUpperCase()}`);
    else toast('Update failed', true);
}

async function deleteUser(key, email) {
    if (!confirm(`Delete user ${email}? This cannot be undone.`)) return;
    const data = await api('/users/delete', 'POST', { userKey: key });
    if (data.success) { toast('User deleted'); loadUsers(); loadStats(); }
    else toast('Delete failed', true);
}

function messageUser(email) {
    // Switch to conversations tab and pre-fill compose
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelector('[data-tab="conversations"]').classList.add('active');
    document.getElementById('tab-conversations').classList.add('active');
    document.getElementById('composeEmail').value = email;
    document.getElementById('composeText').focus();
    loadConversations();
}

// â”€â”€â”€ MESSAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadMessages() {
    document.getElementById('msgsLoading').style.display = 'block';
    document.getElementById('msgsTable').style.display = 'none';
    document.getElementById('msgsEmpty').style.display = 'none';
    document.getElementById('msgDetail').classList.remove('active');

    try {
        const data = await api('/messages');
        document.getElementById('msgsLoading').style.display = 'none';

        if (!data.success || !data.messages.length) {
            document.getElementById('msgsEmpty').style.display = 'block';
            return;
        }

        const tbody = document.getElementById('msgsBody');
        tbody.innerHTML = data.messages.map(m => `
            <tr class="${m.read ? '' : 'unread'}" data-key="${esc(m.key)}">
                <td>${m.read ? '' : '<span class="dot-unread"></span>'}</td>
                <td>${esc(m.name || m.email)}</td>
                <td>${esc(m.subject || 'â€”')}</td>
                <td style="color:var(--muted); max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap">${esc((m.message || '').substring(0, 60))}</td>
                <td style="white-space:nowrap">${formatDate(m.receivedAt)}</td>
                <td>
                    <button class="btn-sm primary" onclick="openMessage('${esc(m.key)}')">Open</button>
                    <button class="btn-sm danger" onclick="deleteMessage('${esc(m.key)}')">Delete</button>
                </td>
            </tr>
        `).join('');
        document.getElementById('msgsTable').style.display = 'block';
    } catch (e) {
        document.getElementById('msgsLoading').style.display = 'none';
        toast('Failed to load messages', true);
    }
}

async function openMessage(key) {
    currentMsgKey = key;
    // Find in current data
    const data = await api('/messages');
    const msg = data.messages.find(m => m.key === key);
    if (!msg) return;

    // Mark as read
    if (!msg.read) {
        await api('/messages/read', 'POST', { messageKey: key });
        loadStats();
    }

    document.getElementById('msgsTable').style.display = 'none';
    document.getElementById('msgDetailMeta').innerHTML = `
        From: <strong>${esc(msg.name)}</strong> &lt;${esc(msg.email)}&gt;<br>
        Subject: ${esc(msg.subject || 'â€”')} &nbsp;|&nbsp; ${formatDate(msg.receivedAt)}
        ${msg.fromMember ? ' &nbsp;|&nbsp; <span style="color:var(--gold)">MEMBER</span>' : ''}
    `;
    document.getElementById('msgDetailBody').textContent = msg.message;

    // Show replies if any
    const repliesDiv = document.getElementById('msgReplies');
    if (msg.replies && msg.replies.length) {
        repliesDiv.innerHTML = '<div style="margin-bottom:1rem;color:var(--muted);font-size:10px;text-transform:uppercase;letter-spacing:1px">Replies</div>' +
            msg.replies.map(r => `
                <div style="background:rgba(194,32,32,0.08);border:1px solid rgba(194,32,32,0.2);padding:0.75rem 1rem;margin-bottom:0.5rem">
                    <div style="color:var(--off-white);font-size:12px">${esc(r.text)}</div>
                    <div style="color:var(--gray);font-size:9px;margin-top:0.3rem">${formatDate(r.sentAt)}</div>
                </div>
            `).join('');
    } else {
        repliesDiv.innerHTML = '';
    }

    document.getElementById('replyInput').value = '';
    document.getElementById('msgDetail').classList.add('active');
}

function closeMsgDetail() {
    document.getElementById('msgDetail').classList.remove('active');
    document.getElementById('msgsTable').style.display = 'block';
    loadMessages();
}

async function sendReply() {
    const text = document.getElementById('replyInput').value.trim();
    if (!text || !currentMsgKey) return;

    const btn = document.getElementById('replyBtn');
    btn.textContent = 'Sending...';
    btn.disabled = true;

    try {
        const data = await api('/messages/reply', 'POST', { messageKey: currentMsgKey, reply: text });
        if (data.success) {
            toast('Reply sent');
            openMessage(currentMsgKey); // Refresh to show reply
        } else toast('Reply failed', true);
    } catch { toast('Reply failed', true); }

    btn.textContent = 'Send';
    btn.disabled = false;
}

async function deleteMessage(key) {
    if (!confirm('Delete this message?')) return;
    const data = await api('/messages/delete', 'POST', { messageKey: key });
    if (data.success) { toast('Deleted'); loadMessages(); loadStats(); }
    else toast('Failed', true);
}

// â”€â”€â”€ CONVERSATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadConversations() {
    document.getElementById('convoList').style.display = 'block';
    document.getElementById('convoThread').style.display = 'none';
    document.getElementById('convosLoading').style.display = 'block';
    document.getElementById('convosTable').style.display = 'none';
    document.getElementById('convosEmpty').style.display = 'none';

    try {
        const data = await api('/conversations');
        document.getElementById('convosLoading').style.display = 'none';

        if (!data.success || !data.conversations.length) {
            document.getElementById('convosEmpty').style.display = 'block';
            return;
        }

        const tbody = document.getElementById('convosBody');
        tbody.innerHTML = data.conversations.map(c => `
            <tr>
                <td>${esc(c.email)}</td>
                <td>${c.messageCount}</td>
                <td style="color:var(--muted);max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">
                    ${c.lastFrom === 'admin' ? '<span style="color:var(--red)">You:</span> ' : ''}${esc(c.lastMessage)}
                </td>
                <td>${formatDate(c.lastAt)}</td>
                <td><button class="btn-sm primary" onclick="openThread('${esc(c.key)}', '${esc(c.email)}')">Open</button> <button class="btn-sm" style="background:#c22020" onclick="deleteConvo('${esc(c.key)}', '${esc(c.email)}')">Delete</button></td>
            </tr>
        `).join('');
        document.getElementById('convosTable').style.display = 'block';
    } catch (e) {
        document.getElementById('convosLoading').style.display = 'none';
        toast('Failed to load conversations', true);
    }
}

async function openThread(key, email) {
    currentConvKey = key;
    currentConvEmail = email;
    document.getElementById('convoList').style.display = 'none';
    document.getElementById('convoThread').style.display = 'block';
    document.getElementById('threadMeta').innerHTML = `Conversation with <strong>${esc(email)}</strong>`;

    const data = await api('/conversations/thread', 'POST', { convKey: key });
    if (!data.success) return;

    const container = document.getElementById('threadMessages');
    container.innerHTML = data.conversation.messages.map(m => `
        <div class="thread-msg from-${m.from === 'admin' ? 'admin' : 'user'}">
            <div>${esc(m.text)}</div>
            <div class="msg-time">${m.from === 'admin' ? 'You' : email} Â· ${formatDate(m.sentAt)}</div>
        </div>
    `).join('');
    container.scrollTop = container.scrollHeight;
    document.getElementById('threadReplyInput').value = '';
}

function closeThread() {
    document.getElementById('convoThread').style.display = 'none';
    document.getElementById('convoList').style.display = 'block';
    loadConversations();
}

async function threadSend() {
    const text = document.getElementById('threadReplyInput').value.trim();
    if (!text || !currentConvEmail) return;

    const data = await api('/conversations/send', 'POST', { email: currentConvEmail, text });
    if (data.success) {
        toast('Sent');
        openThread(currentConvKey, currentConvEmail);
    } else toast('Failed', true);
}

async function deleteConvo(key, email) {
    if (!confirm(`Delete entire conversation with ${email}?`)) return;
    try {
        await api('/conversations/delete', 'POST', { convKey: key });
        toast('Conversation deleted');
        loadConversations();
    } catch (e) { toast('Failed to delete', true); }
}

async function composeSend() {
    const email = document.getElementById('composeEmail').value.trim();
    const text = document.getElementById('composeText').value.trim();
    if (!email || !text) { toast('Email and message required', true); return; }

    const data = await api('/conversations/send', 'POST', { email, text });
    if (data.success) {
        toast('Message sent');
        document.getElementById('composeEmail').value = '';
        document.getElementById('composeText').value = '';
        loadConversations();
    } else toast('Failed', true);
}

// â”€â”€â”€ UTILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(str) {
    if (!str) return '';
    const d = document.createElement('div');
    d.textContent = str;
    return d.innerHTML;
}

function formatDate(iso) {
    if (!iso || iso === 'â€”') return 'â€”';
    try {
        const d = new Date(iso);
        const now = new Date();
        const diff = now - d;
        if (diff < 60000) return 'Just now';
        if (diff < 3600000) return `${Math.floor(diff/60000)}m ago`;
        if (diff < 86400000) return `${Math.floor(diff/3600000)}h ago`;
        if (diff < 604800000) return `${Math.floor(diff/86400000)}d ago`;
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    } catch { return iso; }
}

function toast(msg, err = false) {
    const existing = document.querySelector('.toast');
    if (existing) existing.remove();
    const t = document.createElement('div');
    t.className = `toast ${err ? 'toast-err' : 'toast-ok'}`;
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 300); }, 2500);
}

// â”€â”€â”€ CONTENT MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CONTENT_API = '/api/content';

async function contentApi(path, method = 'GET', body = null) {
    const opts = { method, headers: headers() };
    if (body) opts.body = JSON.stringify(body);
    const r = await fetch(`${CONTENT_API}${path}`, opts);
    return r.json();
}

async function loadContent() {
    document.getElementById('contentLoading').style.display = 'block';
    document.getElementById('contentTable').style.display = 'none';
    document.getElementById('contentEmpty').style.display = 'none';

    try {
        const data = await contentApi('/admin-list');
        document.getElementById('contentLoading').style.display = 'none';

        if (!data.success || !data.content.length) {
            document.getElementById('contentEmpty').style.display = 'block';
            return;
        }

        const tierColors = { free: '#666', vip: 'var(--gold)', elite: '#fff' };
        const typeIcons = { post: 'ğŸ“', gallery: 'ğŸ–¼ï¸', announcement: 'ğŸ“¢' };
        const tbody = document.getElementById('contentBody');
        tbody.innerHTML = data.content.map(c => `
            <tr style="${c.draft ? 'opacity:0.5' : ''}">
                <td style="max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(c.title)}</td>
                <td>${typeIcons[c.type] || 'ğŸ“'} ${esc(c.type)}</td>
                <td style="color:${tierColors[c.tier] || '#666'}">${(c.tier || 'free').toUpperCase()}</td>
                <td>${c.draft ? '<span style="color:var(--muted)">Draft</span>' : '<span style="color:#4a4">Published</span>'}</td>
                <td>${formatDate(c.createdAt)}</td>
                <td>
                    <button class="btn-sm primary" onclick='editContent(${JSON.stringify(JSON.stringify(c))})'>Edit</button>
                    <button class="btn-sm danger" onclick="deleteContent('${esc(c.key)}')">Delete</button>
                </td>
            </tr>
        `).join('');
        document.getElementById('contentTable').style.display = 'block';
    } catch (e) {
        document.getElementById('contentLoading').style.display = 'none';
        toast('Failed to load content', true);
    }
}

function showContentEditor() {
    document.getElementById('contentKey').value = '';
    document.getElementById('contentTitleInput').value = '';
    document.getElementById('contentBody').value = '';
    document.getElementById('contentTier').value = 'free';
    document.getElementById('contentType').value = 'post';
    document.getElementById('contentImage').value = '';
    document.getElementById('editorTitle').textContent = 'New Post';
    document.getElementById('contentEditor').style.display = 'block';
    document.getElementById('contentTitleInput').focus();
}

function hideContentEditor() {
    document.getElementById('contentEditor').style.display = 'none';
}

function editContent(jsonStr) {
    const c = JSON.parse(jsonStr);
    document.getElementById('contentKey').value = c.key || '';
    document.getElementById('contentTitleInput').value = c.title || '';
    document.getElementById('contentBody').value = c.body || '';
    document.getElementById('contentTier').value = c.tier || 'free';
    document.getElementById('contentType').value = c.type || 'post';
    document.getElementById('contentImage').value = c.imageUrl || '';
    document.getElementById('editorTitle').textContent = 'Edit Post';
    document.getElementById('contentEditor').style.display = 'block';
    document.getElementById('contentTitleInput').focus();
}

async function saveContent(draft) {
    const payload = {
        key: document.getElementById('contentKey').value || undefined,
        title: document.getElementById('contentTitleInput').value.trim(),
        body: document.getElementById('contentBody').value.trim(),
        tier: document.getElementById('contentTier').value,
        type: document.getElementById('contentType').value,
        imageUrl: document.getElementById('contentImage').value.trim(),
        draft: draft
    };

    if (!payload.title || !payload.body) { toast('Title and content required', true); return; }

    try {
        const data = await contentApi('/save', 'POST', payload);
        if (data.success) {
            toast(draft ? 'Saved as draft' : 'Published!');
            hideContentEditor();
            loadContent();
        } else toast(data.error || 'Save failed', true);
    } catch { toast('Save failed', true); }
}

async function deleteContent(key) {
    if (!confirm('Delete this content?')) return;
    try {
        const data = await contentApi('/delete', 'POST', { key });
        if (data.success) { toast('Deleted'); loadContent(); }
        else toast('Delete failed', true);
    } catch { toast('Delete failed', true); }
}

// â”€â”€â”€ ANALYTICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAnalytics() {
    try {
        const data = await api('/stats');
        if (!data.success) return;
        const s = data.stats;

        document.getElementById('analSignups7d').textContent = s.recentSignups || 0;
        document.getElementById('analLogins7d').textContent = s.recentLogins || 0;
        document.getElementById('analContent').textContent = s.totalContent || 0;

        const paying = (s.tiers.vip || 0) + (s.tiers.elite || 0);
        document.getElementById('analPaying').textContent = paying;

        // Revenue estimate
        const revenue = (s.tiers.vip || 0) * 9.99 + (s.tiers.elite || 0) * 24.99;
        document.getElementById('analRevenue').textContent = `$${revenue.toFixed(2)}`;

        // Tier distribution chart
        const total = s.totalUsers || 1;
        const tiers = [
            { name: 'Free', count: s.tiers.free || 0, color: '#444' },
            { name: 'Peek', count: s.tiers.peek || 0, color: 'var(--red)' },
            { name: 'VIP', count: s.tiers.vip || 0, color: 'var(--gold)' },
            { name: 'Elite', count: s.tiers.elite || 0, color: '#fff' }
        ].filter(t => t.count > 0);

        const chartEl = document.getElementById('tierChart');
        chartEl.innerHTML = tiers.map(t =>
            `<div style="flex:${t.count};background:${t.color};border-radius:4px;min-width:4px" title="${t.name}: ${t.count}"></div>`
        ).join('');

        const legendEl = document.getElementById('tierLegend');
        legendEl.innerHTML = tiers.map(t =>
            `<span><span style="display:inline-block;width:10px;height:10px;background:${t.color};border-radius:2px;margin-right:4px;vertical-align:middle"></span>${t.name}: ${t.count} (${Math.round(t.count/total*100)}%)</span>`
        ).join('');

        // Signup timeline (aggregate by day, last 30 days)
        if (s.signupDates && s.signupDates.length) {
            const days = {};
            const now = new Date();
            for (let i = 29; i >= 0; i--) {
                const d = new Date(now - i * 86400000);
                const key = d.toISOString().split('T')[0];
                days[key] = 0;
            }
            s.signupDates.forEach(d => {
                const key = d.split('T')[0];
                if (days[key] !== undefined) days[key]++;
            });

            const maxVal = Math.max(1, ...Object.values(days));
            const chartEl2 = document.getElementById('signupChart');
            chartEl2.innerHTML = Object.entries(days).map(([date, count]) => {
                const h = Math.max(2, (count / maxVal) * 100);
                const label = date.split('-').slice(1).join('/');
                return `<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end">
                    <div style="font-size:8px;color:var(--muted);margin-bottom:2px">${count || ''}</div>
                    <div style="width:100%;height:${h}px;background:${count > 0 ? 'var(--red)' : 'rgba(255,255,255,0.05)'};border-radius:2px 2px 0 0;min-height:2px" title="${label}: ${count} signups"></div>
                    <div style="font-size:7px;color:var(--muted);margin-top:2px;transform:rotate(-45deg);white-space:nowrap">${label}</div>
                </div>`;
            }).join('');
        }
    } catch (e) { console.error('Analytics error:', e); }
}

// â”€â”€â”€ PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PIPE_API = '/api/pipeline';
let currentPipeFilter = 'all';
let currentPipeId = null;
let currentPipeItem = null;

async function pipeApi(path, method = 'GET', body = null) {
    const opts = { method, headers: headers() };
    if (body) opts.body = JSON.stringify(body);
    const r = await fetch(`${PIPE_API}${path}`, opts);
    return r.json();
}

async function loadPipelineStats() {
    try {
        const data = await pipeApi('/stats');
        if (!data.success) return;
        const p = data.pipeline;
        document.getElementById('pipeInbox').textContent = p.inbox;
        document.getElementById('pipeProcessed').textContent = p.processed;
        document.getElementById('pipeQueued').textContent = p.queued;
        document.getElementById('pipePublished').textContent = p.published;
        document.getElementById('pipeRejected').textContent = p.rejected;
        document.getElementById('overviewPipeInbox').textContent = p.inbox;
        document.getElementById('overviewPipeQueued').textContent = p.queued;
        document.getElementById('overviewPipePublished').textContent = p.published;
        const badge = document.getElementById('pipelineBadge');
        const pending = p.inbox + p.processed;
        if (pending > 0) { badge.textContent = pending; badge.style.display = 'inline'; }
        else { badge.style.display = 'none'; }
        if (data.recentActivity) renderActivityLog(data.recentActivity);
    } catch (e) { console.error('Pipeline stats error:', e); }
}

function renderActivityLog(logs) {
    const container = document.getElementById('pipeActivityLog');
    if (!logs.length) { container.innerHTML = '<div style="color:var(--gray);font-size:11px;text-align:center;padding:1rem">No recent activity</div>'; return; }
    const actionColors = { 'ingest':'var(--gold)','process':'var(--muted)','approve':'var(--green)','reject':'var(--red)','publish':'var(--green)','delete':'var(--red)','telegram-upload':'var(--gold)','update':'var(--muted)','schedule-check':'var(--muted)','process-all':'var(--muted)','publish-all':'var(--green)','auto-queue':'var(--gold)','scheduled-publish':'var(--green)' };
    container.innerHTML = logs.map(log => {
        const color = actionColors[log.action] || 'var(--muted)';
        return `<div style="display:flex;justify-content:space-between;align-items:center;padding:0.4rem 0;border-bottom:1px solid var(--border);font-size:11px"><span><span style="color:${color};text-transform:uppercase;letter-spacing:1px;font-size:10px">${esc(log.action)}</span> â€” ${esc(log.itemId||'')}</span><span style="color:var(--gray)">${formatDate(log.timestamp)}</span></div>`;
    }).join('');
}

async function loadPipeline() {
    document.getElementById('pipeLoading').style.display = 'block';
    document.getElementById('pipeTable').style.display = 'none';
    document.getElementById('pipeEmpty').style.display = 'none';
    document.getElementById('pipeDetail').classList.remove('active');
    try {
        const data = await pipeApi(`/list?status=${currentPipeFilter}`);
        document.getElementById('pipeLoading').style.display = 'none';
        if (!data.success || !data.items.length) { document.getElementById('pipeEmpty').style.display = 'block'; return; }
        const statusBadge = (s) => { const colors = {inbox:'var(--gold)',processed:'var(--muted)',queued:'var(--gold)',published:'var(--green)',rejected:'var(--red)'}; const c = colors[s]||'var(--muted)'; return `<span style="color:${c};border:1px solid ${c};padding:2px 8px;font-size:10px;text-transform:uppercase;letter-spacing:1px">${s}</span>`; };
        document.getElementById('pipeBody').innerHTML = data.items.map(item => `<tr><td>${statusBadge(item.status)}</td><td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(item.filename)}</td><td style="color:var(--muted);max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(item.caption||'â€”')}</td><td>${esc(item.category||'â€”')}</td><td><span class="tier-badge tier-${item.tier||'free'}">${(item.tier||'free').toUpperCase()}</span></td><td style="font-size:10px;color:var(--muted)">${esc(item.source||'upload')}</td><td style="white-space:nowrap">${formatDate(item.createdAt)}</td><td><button class="btn-sm primary" onclick="openPipeItem('${esc(item.id)}')">Open</button>${item.status==='inbox'?`<button class="btn-sm" onclick="quickProcess('${esc(item.id)}')">Process</button>`:''}${item.status==='queued'?`<button class="btn-sm" onclick="quickPublish('${esc(item.id)}')">Publish</button>`:''}<button class="btn-sm danger" onclick="pipeDeleteItem('${esc(item.id)}')">Del</button></td></tr>`).join('');
        document.getElementById('pipeTable').style.display = 'block';
    } catch (e) { document.getElementById('pipeLoading').style.display = 'none'; toast('Failed to load pipeline', true); }
}

function filterPipeline(status, btn) { currentPipeFilter = status; document.querySelectorAll('.pipe-filter').forEach(b => b.classList.remove('active')); if (btn) btn.classList.add('active'); loadPipeline(); }

async function openPipeItem(id) {
    try {
        const data = await pipeApi(`/item?id=${id}`);
        if (!data.success) { toast('Item not found', true); return; }
        currentPipeId = id; currentPipeItem = data.item; const item = data.item;
        document.getElementById('pipeTable').style.display = 'none';
        document.getElementById('pipeDetailMeta').innerHTML = `<strong>${esc(item.filename)}</strong><br>Status: <span style="color:var(--gold)">${item.status.toUpperCase()}</span> | Source: ${esc(item.source)} | Type: ${esc(item.mediaType)} | Size: ${item.fileSizeMB}MB<br>Created: ${formatDate(item.createdAt)}${item.processedAt?` | Processed: ${formatDate(item.processedAt)}`:''}${item.publishedAt?` | Published: ${formatDate(item.publishedAt)}`:''}${item.scheduledAt?`<br>Scheduled: ${item.scheduledAt}`:''}${item.rejectReason?`<br><span style="color:var(--red)">Rejected: ${esc(item.rejectReason)}</span>`:''}`;
        const preview = document.getElementById('pipeDetailPreview');
        if (item.mediaType==='image'&&item.storedAs) { preview.innerHTML = `<img src="/api/pipeline/asset/${esc(item.storedAs)}" style="max-width:100%;max-height:400px;object-fit:contain" onerror="this.parentNode.innerHTML='<span style=color:var(--gray)>Preview unavailable</span>'">`; }
        else if (item.mediaType==='video') { preview.innerHTML = `<div style="color:var(--muted);padding:2rem">Video file â€” ${esc(item.filename)}</div>`; }
        else { preview.innerHTML = '<span style="color:var(--gray)">Preview unavailable</span>'; }
        const checks = item.checks||{};
        document.getElementById('pipeDetailChecks').innerHTML = `<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:0.5rem">Content Checks</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:0.3rem;font-size:11px"><span>${checks.fileTypeValid?'âœ…':'âŒ'} File type valid</span><span>${checks.fileSizeValid?'âœ…':'âŒ'} File size valid</span><span>${checks.exifStripped?'âœ…':'â³'} EXIF stripped</span><span>${checks.compressed?'âœ…':'â³'} Compressed</span><span>${checks.thumbnailGenerated?'âœ…':'â³'} Thumbnail</span></div>`;
        document.getElementById('pipeEditCaption').value = item.caption||'';
        document.getElementById('pipeEditCategory').value = item.category||'photos';
        document.getElementById('pipeEditTier').value = item.tier||'free';
        document.getElementById('pipeEditSchedule').value = item.scheduledAt?item.scheduledAt.slice(0,16):'';
        document.getElementById('pipeDetail').classList.add('active');
    } catch (e) { toast('Failed to load item', true); }
}

function closePipeDetail() { document.getElementById('pipeDetail').classList.remove('active'); document.getElementById('pipeTable').style.display = 'block'; loadPipeline(); loadPipelineStats(); }

async function pipeSaveItem() {
    if (!currentPipeId) return;
    const data = await pipeApi('/update','POST',{pipelineId:currentPipeId,caption:document.getElementById('pipeEditCaption').value,category:document.getElementById('pipeEditCategory').value,tier:document.getElementById('pipeEditTier').value,scheduledAt:document.getElementById('pipeEditSchedule').value||null});
    if (data.success) toast('Saved'); else toast('Save failed',true);
}

async function pipeApproveItem() {
    if (!currentPipeId) return;
    const data = await pipeApi('/approve','POST',{pipelineId:currentPipeId,caption:document.getElementById('pipeEditCaption').value,category:document.getElementById('pipeEditCategory').value,tier:document.getElementById('pipeEditTier').value,scheduledAt:document.getElementById('pipeEditSchedule').value||null});
    if (data.success) { toast('Approved + queued'); closePipeDetail(); } else toast(data.error||'Approve failed',true);
}

async function pipePublishItem() {
    if (!currentPipeId) return;
    if (currentPipeItem&&currentPipeItem.status!=='queued') {
        const approve = await pipeApi('/approve','POST',{pipelineId:currentPipeId,caption:document.getElementById('pipeEditCaption').value,category:document.getElementById('pipeEditCategory').value,tier:document.getElementById('pipeEditTier').value});
        if (!approve.success) { toast('Failed to queue item first',true); return; }
    }
    const data = await pipeApi('/publish','POST',{pipelineId:currentPipeId});
    if (data.success) { toast('Published!'); closePipeDetail(); } else toast(data.error||'Publish failed',true);
}

async function pipeRejectItem() { if (!currentPipeId) return; const reason = prompt('Reject reason (optional):')||''; const data = await pipeApi('/reject','POST',{pipelineId:currentPipeId,reason}); if (data.success) { toast('Rejected'); closePipeDetail(); } else toast('Reject failed',true); }

async function pipeDeleteItem(id) { if (!confirm('Delete this pipeline item?')) return; const data = await pipeApi('/delete','POST',{pipelineId:id}); if (data.success) { toast('Deleted'); loadPipeline(); loadPipelineStats(); } else toast('Delete failed',true); }
async function quickProcess(id) { const data = await pipeApi('/process','POST',{pipelineId:id}); if (data.success) { toast('Processed'); loadPipeline(); loadPipelineStats(); } else toast('Process failed',true); }
async function quickPublish(id) { const data = await pipeApi('/publish','POST',{pipelineId:id}); if (data.success) { toast('Published!'); loadPipeline(); loadPipelineStats(); } else toast('Publish failed',true); }
async function pipeProcessAll() { if (!confirm('Process all inbox items?')) return; const data = await pipeApi('/process-all','POST'); if (data.success) { toast(`Processed ${data.processed} items`); loadPipeline(); loadPipelineStats(); } else toast('Batch process failed',true); }
async function pipePublishAll() { if (!confirm('Publish all queued items?')) return; const data = await pipeApi('/publish-all','POST'); if (data.success) { toast(`Published ${data.published} items`); loadPipeline(); loadPipelineStats(); } else toast('Batch publish failed',true); }
async function pipeCheckSchedule() { const data = await pipeApi('/check-schedule','POST'); if (data.success) { toast(`Schedule check: ${data.published} items published`); loadPipeline(); loadPipelineStats(); } else toast('Schedule check failed',true); }

function pipeUploadModal() { document.getElementById('pipeUploadPanel').style.display = 'block'; document.getElementById('pipeFileInput').value = ''; document.getElementById('pipeUpCaption').value = ''; }
function pipeCloseUpload() { document.getElementById('pipeUploadPanel').style.display = 'none'; }

async function pipeDoUpload() {
    const fileInput = document.getElementById('pipeFileInput');
    const file = fileInput.files[0];
    if (!file) { toast('Select a file first',true); return; }
    const btn = document.getElementById('pipeUploadBtn');
    const progress = document.getElementById('pipeUploadProgress');
    btn.disabled = true; btn.textContent = 'Uploading...'; progress.style.display = 'block';
    try {
        const reader = new FileReader();
        const fileData = await new Promise((resolve,reject) => { reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = reject; reader.readAsDataURL(file); });
        const data = await pipeApi('/ingest','POST',{filename:file.name,fileSize:file.size,fileData,caption:document.getElementById('pipeUpCaption').value,category:document.getElementById('pipeUpCategory').value,tier:document.getElementById('pipeUpTier').value,source:'upload'});
        if (data.success) { toast('Uploaded to pipeline!'); pipeCloseUpload(); loadPipeline(); loadPipelineStats(); } else { toast(data.error||'Upload failed',true); }
    } catch (e) { toast('Upload error',true); console.error('Upload error:',e); }
    btn.disabled = false; btn.textContent = 'Upload'; progress.style.display = 'none';
}

// â”€â”€â”€ ADMIN PASSWORD RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function resetUserPassword() {
    const email = document.getElementById('resetEmail').value.trim();
    const pass = document.getElementById('resetPass').value;
    if (!email || !pass) { toast('Email and password required', true); return; }
    if (pass.length < 6) { toast('Password must be at least 6 characters', true); return; }

    try {
        const r = await fetch('/api/me/admin-reset', {
            method: 'POST',
            headers: headers(),
            body: JSON.stringify({ email, newPassword: pass })
        });
        const data = await r.json();
        if (data.success) {
            toast(`Password reset for ${email}`);
            document.getElementById('resetEmail').value = '';
            document.getElementById('resetPass').value = '';
        } else toast(data.error || 'Reset failed', true);
    } catch { toast('Reset failed', true); }
}

// â”€â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let calYear = new Date().getFullYear();
let calMonth = new Date().getMonth();
let calItems = [];

function calPrevMonth() { calMonth--; if (calMonth < 0) { calMonth = 11; calYear--; } renderCalendar(); }
function calNextMonth() { calMonth++; if (calMonth > 11) { calMonth = 0; calYear++; } renderCalendar(); }
function calToday() { calYear = new Date().getFullYear(); calMonth = new Date().getMonth(); renderCalendar(); }

async function loadCalendar() {
    try {
        const data = await pipeApi('/list?status=all');
        if (data.success) calItems = data.items.filter(i => i.scheduledAt || i.publishedAt);
    } catch {}
    renderCalendar();
    renderUpcoming();
}

function renderCalendar() {
    const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    document.getElementById('calMonthLabel').textContent = `${months[calMonth]} ${calYear}`;
    const grid = document.getElementById('calGrid');
    const firstDay = new Date(calYear, calMonth, 1).getDay();
    const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();
    const todayStr = new Date().toISOString().split('T')[0];
    let html = '';
    const prevDays = new Date(calYear, calMonth, 0).getDate();
    for (let i = firstDay - 1; i >= 0; i--) html += `<div style="background:var(--dark);opacity:0.4;min-height:80px;padding:0.4rem"><div style="font-size:10px;color:var(--gray)">${prevDays-i}</div></div>`;
    for (let d = 1; d <= daysInMonth; d++) {
        const dateStr = `${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const isToday = dateStr === todayStr;
        const events = calItems.filter(item => (item.scheduledAt?.split('T')[0] === dateStr) || (item.publishedAt?.split('T')[0] === dateStr));
        let ev = events.slice(0,3).map(item => {
            const cls = item.status === 'published' ? 'color:var(--green);background:rgba(46,125,50,0.15)' : 'color:var(--gold);background:rgba(201,168,76,0.15)';
            return `<div style="${cls};font-size:9px;padding:1px 3px;margin-bottom:1px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;border-radius:2px" onclick="openPipeItem('${esc(item.id)}')">${esc((item.caption||item.filename||'').substring(0,14))}</div>`;
        }).join('');
        if (events.length > 3) ev += `<div style="font-size:8px;color:var(--gray)">+${events.length-3}</div>`;
        html += `<div style="background:var(--darker);min-height:80px;padding:0.4rem;${isToday?'border:1px solid var(--red)':''}"><div style="font-size:10px;color:${isToday?'var(--red)':'var(--muted)'};margin-bottom:2px;${isToday?'font-weight:bold':''}">${d}</div>${ev}</div>`;
    }
    const rem = (7 - ((firstDay + daysInMonth) % 7)) % 7;
    for (let i = 1; i <= rem; i++) html += `<div style="background:var(--dark);opacity:0.4;min-height:80px;padding:0.4rem"><div style="font-size:10px;color:var(--gray)">${i}</div></div>`;
    grid.innerHTML = html;
}

function renderUpcoming() {
    const now = new Date().toISOString();
    const upcoming = calItems.filter(i => i.status === 'queued' && i.scheduledAt && i.scheduledAt > now).sort((a,b) => (a.scheduledAt||'').localeCompare(b.scheduledAt||''));
    const c = document.getElementById('calUpcoming');
    if (!upcoming.length) { c.innerHTML = '<div style="color:var(--gray);font-size:11px;text-align:center;padding:1rem">No upcoming scheduled posts</div>'; return; }
    c.innerHTML = upcoming.slice(0,10).map(item => {
        const d = new Date(item.scheduledAt);
        return `<div style="display:flex;justify-content:space-between;align-items:center;padding:0.4rem 0;border-bottom:1px solid var(--border)">
            <span><span style="color:var(--gold);font-size:10px;text-transform:uppercase;letter-spacing:1px">SCHED</span> ${esc(item.caption||item.filename)} <span class="tier-badge tier-${item.tier||'free'}" style="font-size:9px">${(item.tier||'free').toUpperCase()}</span></span>
            <span style="font-size:11px;color:var(--muted)">${d.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})} ${d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})}</span>
        </div>`;
    }).join('');
}

// â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CONFIG_API = '/api/creator-config';
async function configApi(path, method = 'GET', body = null) {
    const opts = { method, headers: headers() };
    if (body) opts.body = JSON.stringify(body);
    const r = await fetch(`${CONFIG_API}${path}`, opts);
    return r.json();
}

async function loadSettingsTab() {
    try {
        const data = await configApi('/get?id=inkedmayhem');
        if (data.success && data.config) {
            const c = data.config;
            document.getElementById('setCreatorName').value = c.name || '';
            document.getElementById('setCreatorHandle').value = c.handle || '';
            document.getElementById('setCreatorTier').value = c.creatorTier || 'A';
            document.getElementById('setModLevel').value = c.moderation?.level || 'manual';
            document.getElementById('setStripExif').checked = c.contentRules?.stripExif !== false;
            document.getElementById('setCompress').checked = c.contentRules?.compressImages !== false;
            document.getElementById('setThumbnails').checked = c.contentRules?.generateThumbnails !== false;
            document.getElementById('setAutoApprove').checked = c.moderation?.autoApproveAfterChecks === true;
        }
    } catch {}
    loadBotStatus();
    loadCreatorsList();
}

async function saveCreatorConfig() {
    try {
        const data = await configApi('/save', 'POST', {
            config: {
                id: 'inkedmayhem',
                name: document.getElementById('setCreatorName').value,
                handle: document.getElementById('setCreatorHandle').value,
                creatorTier: document.getElementById('setCreatorTier').value,
                moderation: { level: document.getElementById('setModLevel').value, autoApproveAfterChecks: document.getElementById('setAutoApprove').checked, notifyOnUpload: true, notifyOnPublish: true },
                contentRules: { stripExif: document.getElementById('setStripExif').checked, compressImages: document.getElementById('setCompress').checked, generateThumbnails: document.getElementById('setThumbnails').checked }
            }
        });
        if (data.success) toast('Config saved'); else toast('Save failed', true);
    } catch { toast('Save failed', true); }
}

async function loadBotStatus() {
    try {
        const r = await fetch('/api/analytics/health');
        const data = await r.json();
        document.getElementById('tgCreatorStatus').innerHTML = `<span style="color:${data.env?.telegramCreator ? 'var(--green)' : 'var(--red)'}">â— Creator: ${data.env?.telegramCreator ? 'OK' : 'Not Set'}</span>`;
        document.getElementById('tgFanStatus').innerHTML = `<span style="color:${data.env?.telegramFan ? 'var(--green)' : 'var(--red)'}">â— Fan: ${data.env?.telegramFan ? 'OK' : 'Not Set'}</span>`;
    } catch {
        document.getElementById('tgCreatorStatus').innerHTML = '<span style="color:var(--gray)">â— Unknown</span>';
        document.getElementById('tgFanStatus').innerHTML = '<span style="color:var(--gray)">â— Unknown</span>';
    }
}

async function setupTelegramBot(botType) {
    const el = document.getElementById('tgSetupResult');
    el.textContent = 'Setting up...';
    try {
        const r = await fetch('/api/telegram/setup', { method: 'POST', headers: headers(), body: JSON.stringify({ botType }) });
        const data = await r.json();
        if (data.success) { el.innerHTML = `<span style="color:var(--green)">Webhook set: ${esc(data.webhookUrl)}</span>`; toast(`${botType} bot configured`); loadBotStatus(); }
        else el.innerHTML = `<span style="color:var(--red)">${esc(data.error || 'Failed')}</span>`;
    } catch { el.innerHTML = '<span style="color:var(--red)">Setup failed</span>'; }
}

async function loadCreatorsList() {
    try {
        const data = await configApi('/list');
        document.getElementById('creatorsListLoading').style.display = 'none';
        const c = document.getElementById('creatorsList');
        if (!data.success || !data.creators?.length) { c.style.display = 'block'; c.innerHTML = '<div style="background:var(--darker);border:1px solid var(--border);padding:1rem;color:var(--gray);font-size:11px">No creators configured.</div>'; return; }
        c.style.display = 'block';
        c.innerHTML = `<div class="table-wrap"><table><thead><tr><th>Name</th><th>Handle</th><th>Tier</th><th>Domain</th></tr></thead><tbody>${data.creators.map(cr => `<tr><td>${esc(cr.name)}</td><td style="color:var(--muted)">${esc(cr.handle)}</td><td><span style="color:var(--gold)">${cr.creatorTier||'A'}</span></td><td style="color:var(--muted);font-size:11px">${esc(cr.domain||'â€”')}</td></tr>`).join('')}</tbody></table></div>`;
    } catch { document.getElementById('creatorsListLoading').style.display = 'none'; }
}

async function onboardCreator() {
    const name = document.getElementById('onboardName').value.trim();
    if (!name) { toast('Name required', true); return; }
    try {
        const data = await configApi('/onboard', 'POST', {
            name, handle: document.getElementById('onboardHandle').value.trim(), tagline: document.getElementById('onboardTagline').value.trim(),
            membership: document.getElementById('onboardMembership').checked, blog: document.getElementById('onboardBlog').checked, faq: document.getElementById('onboardFaq').checked
        });
        const el = document.getElementById('onboardResult');
        if (data.success) {
            el.style.display = 'block';
            el.innerHTML = `<div style="background:rgba(46,125,50,0.1);border:1px solid var(--green);padding:1rem;color:var(--green);font-size:11px"><strong>Onboarded!</strong> ID: ${esc(data.creatorId)}<br>${(data.nextSteps||[]).map(s => 'â€¢ ' + esc(s)).join('<br>')}</div>`;
            toast('Creator onboarded!'); loadCreatorsList();
            document.getElementById('onboardName').value = ''; document.getElementById('onboardHandle').value = ''; document.getElementById('onboardTagline').value = '';
        } else { el.style.display = 'block'; el.innerHTML = `<span style="color:var(--red)">${esc(data.error||'Failed')}</span>`; }
    } catch { toast('Onboard failed', true); }
}
</script>
</body>
</html>
